# GSM8K experiment plots config
# Run: python generate_staleness_plots.py gsm8k_experiments.yaml
# All runs trained on GSM8K with Qwen3-1.7B-Base

output: gsm8k_plots.js
html_prefix: gsm8k

runs:
  # ── DAPO ──
  - id: dapo-lr1e5
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-dapo-lr1e5_20260129-222310
    label: "DAPO lr=1e-5"
    color: "#3b82f6"
    family: dapo
  - id: dapo-lr5e6
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-dapo-lr5e6_20260129-213056
    label: "DAPO lr=5e-6"
    color: "#60a5fa"
    family: dapo

  # ── GRPO ──
  - id: grpo-lr1e5
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-grpo-lr1e5_20260130-012436
    label: "GRPO lr=1e-5"
    color: "#22c55e"
    family: grpo
  - id: grpo-lr5e6
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-grpo-lr5e6_20260129-213606
    label: "GRPO lr=5e-6"
    color: "#4ade80"
    family: grpo

  # ── DAPO + SFT ──
  - id: dapo-sft-lr1e5
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-dapo-sft-lr1e5_20260130-005912
    label: "DAPO+SFT lr=1e-5"
    color: "#f97316"
    family: dapo-sft
  - id: dapo-sft-lr5e6
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-dapo-sft-lr5e6_20260130-005852
    label: "DAPO+SFT lr=5e-6"
    color: "#fb923c"
    family: dapo-sft

  # ── GRPO + SFT ──
  - id: grpo-sft-lr1e5
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-grpo-sft-lr1e5_20260130-022119
    label: "GRPO+SFT lr=1e-5"
    color: "#a855f7"
    family: grpo-sft
  - id: grpo-sft-lr5e6
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-grpo-sft-lr5e6_20260130-002249
    label: "GRPO+SFT lr=5e-6"
    color: "#c084fc"
    family: grpo-sft

  # ── Staleness ablation (DAPO, lr=5e-6) ──
  # stale0 = dapo-lr5e6 above
  - id: dapo-stale1
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-dapo-lr5e6-stale1_20260131-005831
    label: "DAPO stale=1"
    color: "#38bdf8"
    family: staleness
  - id: dapo-stale2
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-dapo-lr5e6-stale2_20260131-052241
    label: "DAPO stale=2"
    color: "#7dd3fc"
    family: staleness
  - id: dapo-stale4
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-dapo-lr5e6-stale4_20260131-070356
    label: "DAPO stale=4"
    color: "#bae6fd"
    family: staleness

  # ── Staleness ablation (GRPO, lr=5e-6) ──
  # stale0 = grpo-lr5e6 above
  - id: grpo-stale1
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-grpo-lr5e6-stale1_20260131-010105
    label: "GRPO stale=1"
    color: "#34d399"
    family: staleness
  - id: grpo-stale2
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-grpo-lr5e6-stale2_20260131-051827
    label: "GRPO stale=2"
    color: "#6ee7b7"
    family: staleness
  - id: grpo-stale4
    run_dir: /efs/rlvr-experiments/results/qwen3-1.7B-gsm8k-grpo-lr5e6-stale4_20260131-070653
    label: "GRPO stale=4"
    color: "#a7f3d0"
    family: staleness

base_model:
  label: "Qwen3-1.7B-Base"
  evals_dir: /efs/rlvr-experiments/results/qwen3-1.7B-base/evals

exclude_benchmarks: [ifeval, ifbench_test, if_multi_constraints]

presets:
  - id: grpo-vs-dapo
    label: "GRPO vs DAPO"
    runs: [grpo-lr1e5, grpo-lr5e6, dapo-lr1e5, dapo-lr5e6]
    text: "GRPO vs DAPO at two learning rates. Both algorithms reach ~83% GSM8k at lr=1e-5, but trade off MATH accuracy. At lr=5e-6, both preserve MATH (~56%) with similar GSM8k (~79%)."

  - id: grpo-sft
    label: "GRPO vs GRPO+SFT"
    runs: [grpo-lr1e5, grpo-sft-lr1e5, grpo-lr5e6, grpo-sft-lr5e6]
    text: "Effect of SFT auxiliary loss on GRPO. At lr=1e-5, +SFT slightly lowers GSM8k (83.2→81.4%) but preserves MATH better."

  - id: dapo-sft
    label: "DAPO vs DAPO+SFT"
    runs: [dapo-lr1e5, dapo-sft-lr1e5, dapo-lr5e6, dapo-sft-lr5e6]
    text: "Effect of SFT auxiliary loss on DAPO. At lr=1e-5, +SFT trades 1.3pp GSM8k (83.9→82.6%) for +10pp MATH (43.3→53.7%)."

  - id: staleness
    label: "Staleness"
    runs: [dapo-lr5e6, dapo-stale1, dapo-stale2, dapo-stale4, grpo-lr5e6, grpo-stale1, grpo-stale2, grpo-stale4]
    text: "Staleness ablation at lr=5e-6. max_staleness=0 (on-policy) vs 1, 2, 4 steps of allowed staleness for both DAPO and GRPO. Minimal impact on final accuracy."
